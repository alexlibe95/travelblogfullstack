<div class="container mt-4">
  <h1>API Test Page</h1>
  <p class="text-muted">Test all available API endpoints</p>

  <!-- Status Display -->
  @if (error(); as errorMsg) {
    <div class="alert alert-danger" role="alert">
      <strong>Error:</strong> {{ errorMsg }}
    </div>
  }

  @if (isLoading()) {
    <div class="alert alert-info" role="alert">
      Loading...
    </div>
  }

  @if (sessionToken(); as token) {
    <div class="alert alert-success" role="alert">
      <strong>Authenticated:</strong> Session token active
    </div>
  }

  <!-- Health Check -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>1. Health Check - GET /health</h5>
    </div>
    <div class="card-body">
      <button class="btn btn-primary" (click)="checkHealth()" [disabled]="isLoading()">
        Check Health
      </button>
      @if (healthStatus(); as health) {
        <pre class="mt-3">{{ health | json }}</pre>
      }
    </div>
  </div>

  <!-- Root Endpoint -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>2. Root Endpoint - GET /</h5>
    </div>
    <div class="card-body">
      <button class="btn btn-primary" (click)="getRootInfo()" [disabled]="isLoading()">
        Get Root Info
      </button>
      @if (rootInfo(); as info) {
        <pre class="mt-3">{{ info | json }}</pre>
      }
    </div>
  </div>

  <!-- Authentication -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>3. Authentication</h5>
    </div>
    <div class="card-body">
      @if (!sessionToken()) {
        <form [formGroup]="loginForm" (ngSubmit)="login()">
          <div class="mb-3">
            <label for="loginUsername" class="form-label">Username</label>
            <input 
              type="text" 
              class="form-control" 
              id="loginUsername"
              formControlName="username" 
              placeholder="admin"
              [class.is-invalid]="loginForm.get('username')?.invalid && loginForm.get('username')?.touched">
            @if (loginForm.get('username')?.invalid && loginForm.get('username')?.touched) {
              <div class="invalid-feedback">
                Username is required
              </div>
            }
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <input 
              type="password" 
              class="form-control" 
              id="loginPassword"
              formControlName="password" 
              placeholder="password"
              [class.is-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
            @if (loginForm.get('password')?.invalid && loginForm.get('password')?.touched) {
              <div class="invalid-feedback">
                Password is required
              </div>
            }
          </div>
          <button type="submit" class="btn btn-success" [disabled]="isLoading() || loginForm.invalid">
            Login - POST /api/auth/login
          </button>
        </form>
      } @else {
        <button class="btn btn-warning" (click)="logout()" [disabled]="isLoading()">
          Logout - POST /api/auth/logout
        </button>
      }
    </div>
  </div>

  <!-- Get All Islands -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>4. Get All Islands - GET /api/islands</h5>
    </div>
    <div class="card-body">
      <button class="btn btn-primary" (click)="getAllIslands()" [disabled]="isLoading()">
        Fetch All Islands
      </button>
      @if (islands() && (islands()?.length ?? 0) > 0) {
        <div class="mt-3">
          <p><strong>Found {{ islands()?.length ?? 0 }} islands:</strong></p>
          <ul class="list-group">
            @for (island of islands() ?? []; track island?.objectId) {
              <li class="list-group-item">
                <strong>{{ island?.name }}</strong> - {{ island?.short_description }}
              </li>
            }
          </ul>
        </div>
      }
    </div>
  </div>

  <!-- Get Island by ID -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>5. Get Island by ID - GET /api/islands/&#123;id&#125;</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="islandIdForm" (ngSubmit)="getIslandById()">
        <div class="mb-3">
          <label for="islandId" class="form-label">Island ID</label>
          <input 
            type="text" 
            class="form-control" 
            id="islandId"
            formControlName="id" 
            placeholder="Enter island ID"
            [class.is-invalid]="islandIdForm.get('id')?.invalid && islandIdForm.get('id')?.touched">
          @if (islandIdForm.get('id')?.invalid && islandIdForm.get('id')?.touched) {
            <div class="invalid-feedback">
              Island ID is required
            </div>
          }
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading() || islandIdForm.invalid">
          Get Island Details
        </button>
      </form>
      @if (selectedIsland(); as island) {
        <div class="mt-3">
          <pre>{{ island | json }}</pre>
        </div>
      }
    </div>
  </div>

  <!-- Update Island -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>6. Update Island - PUT /api/islands/&#123;id&#125; (Admin Only)</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="updateIslandForm" (ngSubmit)="updateIsland()">
        <div class="mb-3">
          <label for="updateIslandId" class="form-label">Island ID</label>
          <input 
            type="text" 
            class="form-control" 
            id="updateIslandId"
            formControlName="id" 
            placeholder="Enter island ID"
            [class.is-invalid]="updateIslandForm.get('id')?.invalid && updateIslandForm.get('id')?.touched">
          @if (updateIslandForm.get('id')?.invalid && updateIslandForm.get('id')?.touched) {
            <div class="invalid-feedback">
              Island ID is required
            </div>
          }
        </div>
        <div class="mb-3">
          <label for="updateName" class="form-label">Name (optional)</label>
          <input 
            type="text" 
            class="form-control" 
            id="updateName"
            formControlName="name" 
            placeholder="New name">
        </div>
        <div class="mb-3">
          <label for="updateDescription" class="form-label">Description (optional)</label>
          <textarea 
            class="form-control" 
            id="updateDescription"
            formControlName="description" 
            placeholder="New description"
            rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-warning" [disabled]="isLoading() || !sessionToken() || updateIslandForm.invalid">
          Update Island
        </button>
      </form>
    </div>
  </div>

  <!-- Upload Photo -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>7. Upload Photo - POST /api/islands/&#123;id&#125;/photo (Admin Only)</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="islandIdForm">
        <div class="mb-3">
          <label for="uploadIslandId" class="form-label">Island ID</label>
          <input 
            type="text" 
            class="form-control" 
            id="uploadIslandId"
            formControlName="id" 
            placeholder="Enter island ID"
            [class.is-invalid]="islandIdForm.get('id')?.invalid && islandIdForm.get('id')?.touched">
          @if (islandIdForm.get('id')?.invalid && islandIdForm.get('id')?.touched) {
            <div class="invalid-feedback">
              Island ID is required
            </div>
          }
        </div>
        <div class="mb-3">
          <label for="photoFile" class="form-label">Photo File</label>
          <input 
            type="file" 
            class="form-control" 
            id="photoFile"
            accept="image/*" 
            (change)="uploadIslandPhoto($event)" 
            [disabled]="isLoading() || !sessionToken() || islandIdForm.invalid">
        </div>
      </form>
    </div>
  </div>

  <!-- Search Islands -->
  <div class="card mb-3">
    <div class="card-header">
      <h5>8. Search Islands - GET /api/search?q=&#123;query&#125;</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="searchForm" (ngSubmit)="searchIslands()">
        <div class="mb-3">
          <label for="searchQuery" class="form-label">Search Query</label>
          <input 
            type="text" 
            class="form-control" 
            id="searchQuery"
            formControlName="query" 
            placeholder="Enter search term"
            [class.is-invalid]="searchForm.get('query')?.invalid && searchForm.get('query')?.touched">
          @if (searchForm.get('query')?.invalid && searchForm.get('query')?.touched) {
            <div class="invalid-feedback">
              Search query is required
            </div>
          }
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading() || searchForm.invalid">
          Search
        </button>
      </form>
      @if (searchResults() && (searchResults()?.length ?? 0) > 0) {
        <div class="mt-3">
          <p><strong>Search Results:</strong></p>
          <ul class="list-group">
            @for (result of searchResults() ?? []; track result?.id) {
              <li class="list-group-item">
                <strong>{{ result?.name }}</strong> (ID: {{ result?.id }})
              </li>
            }
          </ul>
        </div>
      }
    </div>
  </div>
</div>
